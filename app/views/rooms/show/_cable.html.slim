javascript:
  current_game_challenge_ids = []
  current_game_id = ""

  $(document).ready(function(){
    App.global_chat = App.cable.subscriptions.create(
      {
        channel: "RoomChannel",
        room_id: $('#rooms-show').attr('data-room-id')
      },
      {
        connected: function(data) {
          console.log('connected')
          enableChatInput()
        },

        disconnected: function(data) {
          console.log('disconnected')
          disableChatInput()
        },
        received: function(data) {
          console.log('received', data)
          da_t = data['data_type']
          if(da_t == 'test'){
            console.log('test')
          }
          else if (da_t == 'chat'){
            displayChatMessage(data['sender_name'], data['chat_body'])
          }
          else if (da_t == 'game_status'){
            mg = data['message']
            if(mg == 'start_game'){
              startGame(data['game_id'])
            }
          }
        },

        emit: function(data){
          data['room_id'] = $('#rooms-show').attr('data-room-id')
          return this.perform('emit', data)
        }
      }
    )
    hookChatInput()
  })

  //chats
  function displayChatMessage(name, body){
    $('#room-chat-messages').append("<div class='chat-message'>" + name +" : " + body + "</div>")
  }

  function disableChatInput(){
    //TODO
  }

  function enableChatInput(){
    //TODO
  }

  function hookChatInput(){
    $('#room-chat-input-container form').submit(function(e){
      if($(this).find('input[type=text]').val() == ''){
        e.preventDefault()
      }
      else{
        setTimeout(function() {
          $('#room-chat-input-container form').find('input[type=text]').val('')
        }, 10)
      }
    })
  }

  //game
  function startGame(game_id){
    $('[data-entity=start-game-btn] button').addClass('hidden')
    $.get('/games/'+game_id+'/load')
    current_game_id = game_id
  }

  function loadChallenges(challenge_ids){
    current_game_challenge_ids = challenge_ids
    loadChallenge(current_game_challenge_ids[0])
  }
  
  function loadChallenge(challenge_id){
    $.get("/challenges/"+challenge_id+"/load?game_id=" + current_game_id )
  }
  
  function completedChallenge(challenge_id){
    challenge_ids = current_game_challenge_ids
    for( var i = 0; i < challenge_ids.length; i++){ 
      if ( challenge_ids[i] === challenge_id) {
        challenge_ids.splice(i, 1); 
        i--;
        break;
      }
    }
    current_game_challenge_ids = challenge_ids
    displayChallengeCompletedConfetti()
    loadChallenge(current_game_challenge_ids[0])
  }
  
  function displayChallengeCompletedConfetti(){
    //TODO cool confetti
    console.log('yay')
  }
  
  function displayChallengeCompletedConfettiForUser(user_hash){
    console.log('yay for', user_hash)
  }
  
  function completedGame(){
    $("#code-main-wrapper")
  }
  
  function displaycompletedGameConfettiForUser(user_hash){
    console.log('yay for', user_hash)
  }
